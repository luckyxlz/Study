# 线程安全

### 线程安全问题

我们前面的操作线程与线程间都是互不干扰，各自执行，不会存在线程安全问题。**当多条线程操作同一个资源时**，就会产生线程安全问题；



### 线程同步

**当我们使用多个线程访问同一资源的时候，且多个线程中对资源有写的操作**，就容易出现线程安全问题。要解决上述多线程并发访问一个资源的安全性问题：Java中提供了同步机制(**synchronized**)来解决。

Java中提供了三种方式完成同步操作：

- 同步代码块。
- 同步方法。
- 锁机制。



#### 同步代码块

- 同步代码块：`synchronized`关键字可以用于方法中的某个区块中，表示只对这个区块的资源实行互斥访问。

语法：

```java
synchronized(同步锁){
     需要同步操作的代码
}
```

**同步锁**：

对象的同步锁只是一个概念，可以想象为在对象上标记了一个锁；

1. 锁对象可以是任意类型。
2. 多个线程对象 要使用同一把锁。

> 注意：在任何时候，最多允许一个线程拥有同步锁,谁拿到锁就进入代码块,其他的线程只能在外等着(BLOCKED)。



#### 同步方法

> 注意：同步方法也是有锁对象的，对于静态方法的锁对象的当前类的字节码对象（.class），对于非静态的方法的锁对象是this；



#### Lock锁

`java.util.concurrent.locks.Lock`机制提供了比`synchronized`代码块和`synchronized`方法更广泛的锁定操作，同步代码块/同步方法具有的功能Lock都有，除此之外更强大，更体现面向对象。

Lock锁也称同步锁，加锁与释放锁方法化了，如下：

- `public void lock()` ：加同步锁。
- `public void unlock()`：释放同步锁。





### 线程死锁

多线程同步的时候，如果同步代码嵌套，使用相同锁，就有可能出现死锁；

 